# OISSTæ•°æ®åº“æ‰¹æ¬¡ä¼˜åŒ–æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæ‰¹æ¬¡1ï¼ˆå¿…éœ€ï¼‰
```bash
cd database
node run_batch_optimization.js 1
```

æˆ–ä½¿ç”¨äº¤äº’å¼èœå•ï¼š
```bash
node run_batch_optimization.js
```

### 2. æµ‹è¯•æŸ¥è¯¢æ€§èƒ½
æ‰¹æ¬¡1å®ŒæˆåŽï¼Œç«‹å³æµ‹è¯•APIæ€§èƒ½ï¼š
```bash
curl "http://localhost:3000/api/sst-data?queryType=exact&lat=25.5&lon=-80.5&startDate=2023-01-01&endDate=2023-12-31&limit=100"
```

### 3. ç»§ç»­å…¶ä»–æ‰¹æ¬¡ï¼ˆå¯é€‰ï¼‰
```bash
# æ‰¹æ¬¡2
node run_batch_optimization.js 2

# æ‰¹æ¬¡3
node run_batch_optimization.js 3
```

## æ‰¹æ¬¡è¯´æ˜Ž

### æ‰¹æ¬¡1ï¼šæ ¸å¿ƒç´¢å¼• ðŸ”´
- **æ–‡ä»¶**: `batch_optimize.sql`
- **ç´¢å¼•**: `idx_noaa_lat_lon_date`
- **æ—¶é—´**: 2-5å°æ—¶
- **é‡è¦æ€§**: è§£å†³90%çš„æŸ¥è¯¢æ€§èƒ½é—®é¢˜
- **æ•ˆæžœ**: ç»çº¬åº¦+æ—¥æœŸæŸ¥è¯¢ä»Žè¶…æ—¶ä¼˜åŒ–åˆ°æ¯«ç§’çº§

### æ‰¹æ¬¡2ï¼šæ—¥æœŸæ¸©åº¦ç´¢å¼• ðŸŸ¡
- **æ–‡ä»¶**: `batch_optimize2.sql`
- **ç´¢å¼•**: `idx_noaa_date`, `idx_noaa_sst`, `idx_noaa_year_month`
- **æ—¶é—´**: 1-2å°æ—¶
- **é‡è¦æ€§**: æå‡æ—¥æœŸèŒƒå›´å’Œæ¸©åº¦ç­›é€‰æ€§èƒ½

### æ‰¹æ¬¡3ï¼šè¾…åŠ©ç´¢å¼• ðŸŸ¡
- **æ–‡ä»¶**: `batch_optimize3.sql`
- **ç´¢å¼•**: `idx_noaa_lat`, `idx_noaa_lon`
- **æ—¶é—´**: 30-60åˆ†é’Ÿ
- **é‡è¦æ€§**: å•ç‹¬åæ ‡æŸ¥è¯¢ä¼˜åŒ–

## ä¼˜åŒ–ç­–ç•¥

### ç«‹å³ç”Ÿæ•ˆ
åªéœ€å®Œæˆ**æ‰¹æ¬¡1**å³å¯èŽ·å¾—ï¼š
- âœ… ç²¾ç¡®ç»çº¬åº¦æŸ¥è¯¢åŠ é€Ÿ
- âœ… æ—¥æœŸèŒƒå›´æŸ¥è¯¢åŠ é€Ÿ
- âœ… APIä¸å†è¶…æ—¶
- âœ… 1.45äº¿æ•°æ®æ¯«ç§’çº§å“åº”

### åŽç»­ä¼˜åŒ–
æ‰¹æ¬¡2å’Œ3å¯ä»¥ç¨åŽåœ¨ä½Žè´Ÿè½½æ—¶æ‰§è¡Œï¼š
- æå‡ç‰¹å®šæŸ¥è¯¢åœºæ™¯çš„æ€§èƒ½
- å‡å°‘æŸ¥è¯¢èµ„æºæ¶ˆè€—
- è¿›ä¸€æ­¥é™ä½Žå¹³å‡æŸ¥è¯¢æ—¶é—´

## ç›‘æŽ§å»ºè®®

æ‰¹æ¬¡1å®ŒæˆåŽï¼Œç›‘æŽ§ä»¥ä¸‹æŒ‡æ ‡ï¼š

```sql
-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT
  TABLE_NAME,
  INDEX_NAME,
  CARDINALITY,
  SUB_PART,
  PACKED,
  NULLABLE,
  INDEX_TYPE
FROM information_schema.STATISTICS
WHERE TABLE_SCHEMA = 'oisst' AND TABLE_NAME = 'noaa';
```

## æ€§èƒ½å¯¹æ¯”

| æŸ¥è¯¢ç±»åž‹ | ä¼˜åŒ–å‰ | æ‰¹æ¬¡1åŽ | å…¨éƒ¨ä¼˜åŒ–åŽ |
|---------|-------|--------|-----------|
| ç²¾ç¡®ç»çº¬åº¦ | >30ç§’/è¶…æ—¶ | <50ms | <30ms |
| æ—¥æœŸèŒƒå›´ | >30ç§’/è¶…æ—¶ | <200ms | <50ms |
| åŒºåŸŸæŸ¥è¯¢ | >30ç§’/è¶…æ—¶ | <500ms | <100ms |
| æ¸©åº¦ç­›é€‰ | >30ç§’/è¶…æ—¶ | >5ç§’ | <200ms |

## æ•…éšœæŽ’é™¤

### ä¸­æ–­å¤„ç†
å¦‚æžœæ‰¹æ¬¡æ‰§è¡Œä¸­æ–­ï¼š
1. æ£€æŸ¥å·²åˆ›å»ºçš„ç´¢å¼•
2. é‡æ–°è¿è¡Œç›¸åŒæ‰¹æ¬¡
3. å·²åˆ›å»ºçš„ç´¢å¼•ä¼šè‡ªåŠ¨è·³è¿‡

### æ€§èƒ½é—®é¢˜
å¦‚æžœç´¢å¼•åˆ›å»ºè¿‡æ…¢ï¼š
1. å¢žåŠ MySQLç¼“å†²åŒºï¼š
   ```sql
   SET GLOBAL innodb_buffer_pool_size = 4294967296; -- 4GB
   ```
2. åœæ­¢å…¶ä»–æŸ¥è¯¢
3. åœ¨ç»´æŠ¤çª—å£æ‰§è¡Œ

### ç£ç›˜ç©ºé—´
ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´ï¼š
- ç´¢å¼•æ€»å¤§å°ï¼š15-20GB
- ä¸´æ—¶ç©ºé—´ï¼š10GB
- æ€»è®¡éœ€è¦ï¼š30GB

## å›žæ»šæ–¹æ¡ˆ

å¦‚éœ€åˆ é™¤ç´¢å¼•ï¼š
```sql
DROP INDEX idx_noaa_lat_lon_date ON noaa;
DROP INDEX idx_noaa_date ON noaa;
DROP INDEX idx_noaa_sst ON noaa;
DROP INDEX idx_noaa_year_month ON noaa;
DROP INDEX idx_noaa_lat ON noaa;
DROP INDEX idx_noaa_lon ON noaa;
```

## æœ€ä½³å®žè·µ

1. **æ‰¹æ¬¡1ä¼˜å…ˆ**ï¼šç«‹å³è§£å†³ä¸»è¦æ€§èƒ½é—®é¢˜
2. **ä½Žè´Ÿè½½æ‰§è¡Œ**ï¼šé¿å…å½±å“ä¸šåŠ¡
3. **ç›‘æŽ§è¿›åº¦**ï¼šå®šæœŸæ£€æŸ¥æ‰§è¡ŒçŠ¶æ€
4. **æµ‹è¯•éªŒè¯**ï¼šæ¯ä¸ªæ‰¹æ¬¡å®ŒæˆåŽæµ‹è¯•APIæ€§èƒ½
5. **å¤‡ä»½é‡è¦**ï¼šè™½ç„¶ç´¢å¼•åˆ›å»ºä¸å½±å“æ•°æ®ï¼Œä½†å»ºè®®æœ‰å¤‡ä»½